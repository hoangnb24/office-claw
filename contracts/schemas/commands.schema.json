{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://officeclaw.dev/schemas/commands.schema.json",
  "title": "OfficeClaw Command and Error Contracts",
  "$defs": {
    "command_name": {
      "type": "string",
      "enum": [
        "submit_request",
        "assign_task",
        "auto_assign",
        "resolve_decision",
        "approve_artifact",
        "request_changes",
        "split_into_tasks",
        "player_pos",
        "move_player_to",
        "start_kickoff",
        "reassign_task",
        "cancel_task",
        "pause_project",
        "resume_project",
        "rerun_task"
      ]
    },
    "error_code": {
      "type": "string",
      "enum": ["VALIDATION_FAILED", "NOT_FOUND", "CONFLICT", "RATE_LIMITED", "NOT_ALLOWED", "INTERNAL"]
    },
    "command_payload": {
      "type": "object",
      "required": ["name", "data"],
      "additionalProperties": true,
      "properties": {
        "name": {"$ref": "#/$defs/command_name"},
        "data": {"type": "object"}
      },
      "allOf": [
        {
          "if": {"properties": {"name": {"const": "submit_request"}}},
          "then": {
            "properties": {
              "data": {
                "type": "object",
                "required": ["text"],
                "properties": {
                  "text": {"type": "string", "minLength": 1},
                  "constraints": {"type": "object"},
                  "attachments": {"type": "array"}
                },
                "additionalProperties": true
              }
            }
          }
        },
        {
          "if": {"properties": {"name": {"const": "assign_task"}}},
          "then": {
            "properties": {
              "data": {
                "type": "object",
                "required": ["task_id", "agent_id"],
                "properties": {
                  "task_id": {
                    "$ref": "https://officeclaw.dev/schemas/identifiers.schema.json#/$defs/task_id"
                  },
                  "agent_id": {
                    "$ref": "https://officeclaw.dev/schemas/identifiers.schema.json#/$defs/agent_id"
                  }
                },
                "additionalProperties": true
              }
            }
          }
        },
        {
          "if": {"properties": {"name": {"const": "auto_assign"}}},
          "then": {
            "properties": {
              "data": {
                "type": "object",
                "required": ["project_id"],
                "properties": {
                  "project_id": {
                    "$ref": "https://officeclaw.dev/schemas/identifiers.schema.json#/$defs/project_id"
                  }
                },
                "additionalProperties": true
              }
            }
          }
        },
        {
          "if": {"properties": {"name": {"const": "resolve_decision"}}},
          "then": {
            "properties": {
              "data": {
                "type": "object",
                "required": ["decision_id", "choice"],
                "properties": {
                  "decision_id": {
                    "$ref": "https://officeclaw.dev/schemas/identifiers.schema.json#/$defs/decision_id"
                  },
                  "choice": {"type": "string", "minLength": 1},
                  "note": {"type": "string"}
                },
                "additionalProperties": true
              }
            }
          }
        },
        {
          "if": {"properties": {"name": {"const": "approve_artifact"}}},
          "then": {
            "properties": {
              "data": {
                "type": "object",
                "required": ["artifact_id"],
                "properties": {
                  "artifact_id": {
                    "$ref": "https://officeclaw.dev/schemas/identifiers.schema.json#/$defs/artifact_id"
                  }
                },
                "additionalProperties": true
              }
            }
          }
        },
        {
          "if": {"properties": {"name": {"const": "request_changes"}}},
          "then": {
            "properties": {
              "data": {
                "type": "object",
                "required": ["artifact_id", "instructions"],
                "properties": {
                  "artifact_id": {
                    "$ref": "https://officeclaw.dev/schemas/identifiers.schema.json#/$defs/artifact_id"
                  },
                  "instructions": {"type": "string", "minLength": 1}
                },
                "additionalProperties": true
              }
            }
          }
        },
        {
          "if": {"properties": {"name": {"const": "split_into_tasks"}}},
          "then": {
            "properties": {
              "data": {
                "type": "object",
                "required": ["artifact_id", "task_titles"],
                "properties": {
                  "artifact_id": {
                    "$ref": "https://officeclaw.dev/schemas/identifiers.schema.json#/$defs/artifact_id"
                  },
                  "task_titles": {
                    "type": "array",
                    "minItems": 1,
                    "items": {"type": "string", "minLength": 1}
                  }
                },
                "additionalProperties": true
              }
            }
          }
        },
        {
          "if": {"properties": {"name": {"const": "player_pos"}}},
          "then": {
            "properties": {
              "data": {
                "type": "object",
                "required": ["pos"],
                "properties": {
                  "pos": {
                    "type": "array",
                    "items": {"type": "number"},
                    "minItems": 3,
                    "maxItems": 3
                  },
                  "facing": {
                    "type": "array",
                    "items": {"type": "number"},
                    "minItems": 3,
                    "maxItems": 3
                  }
                },
                "additionalProperties": true
              }
            }
          }
        },
        {
          "if": {"properties": {"name": {"const": "move_player_to"}}},
          "then": {
            "properties": {
              "data": {
                "type": "object",
                "required": ["pos"],
                "properties": {
                  "pos": {
                    "type": "array",
                    "items": {"type": "number"},
                    "minItems": 3,
                    "maxItems": 3
                  },
                  "arrival_radius": {"type": "number", "exclusiveMinimum": 0}
                },
                "additionalProperties": true
              }
            }
          }
        },
        {
          "if": {"properties": {"name": {"const": "start_kickoff"}}},
          "then": {
            "properties": {
              "data": {
                "type": "object",
                "properties": {
                  "project_id": {
                    "$ref": "https://officeclaw.dev/schemas/identifiers.schema.json#/$defs/project_id"
                  }
                },
                "additionalProperties": true
              }
            }
          }
        },
        {
          "if": {"properties": {"name": {"const": "reassign_task"}}},
          "then": {
            "properties": {
              "data": {
                "type": "object",
                "required": ["task_id", "to_agent_id"],
                "properties": {
                  "task_id": {
                    "$ref": "https://officeclaw.dev/schemas/identifiers.schema.json#/$defs/task_id"
                  },
                  "from_agent_id": {
                    "$ref": "https://officeclaw.dev/schemas/identifiers.schema.json#/$defs/agent_id"
                  },
                  "to_agent_id": {
                    "$ref": "https://officeclaw.dev/schemas/identifiers.schema.json#/$defs/agent_id"
                  },
                  "reason": {"type": "string", "minLength": 1},
                  "expected_task_status": {
                    "type": "string",
                    "enum": ["planned", "in_progress", "blocked", "done", "cancelled"]
                  }
                },
                "additionalProperties": true
              }
            }
          }
        },
        {
          "if": {"properties": {"name": {"const": "cancel_task"}}},
          "then": {
            "properties": {
              "data": {
                "type": "object",
                "required": ["task_id", "confirm"],
                "properties": {
                  "task_id": {
                    "$ref": "https://officeclaw.dev/schemas/identifiers.schema.json#/$defs/task_id"
                  },
                  "confirm": {"const": true},
                  "reason": {"type": "string", "minLength": 1},
                  "expected_task_status": {
                    "type": "string",
                    "enum": ["planned", "in_progress", "blocked", "done", "cancelled"]
                  }
                },
                "additionalProperties": true
              }
            }
          }
        },
        {
          "if": {"properties": {"name": {"const": "pause_project"}}},
          "then": {
            "properties": {
              "data": {
                "type": "object",
                "required": ["project_id"],
                "properties": {
                  "project_id": {
                    "$ref": "https://officeclaw.dev/schemas/identifiers.schema.json#/$defs/project_id"
                  },
                  "reason": {"type": "string", "minLength": 1},
                  "scope": {"type": "string", "enum": ["dispatch_only"]},
                  "expected_project_status": {
                    "type": "string",
                    "enum": [
                      "created",
                      "planning",
                      "executing",
                      "blocked",
                      "completed",
                      "archived"
                    ]
                  }
                },
                "additionalProperties": true
              }
            }
          }
        },
        {
          "if": {"properties": {"name": {"const": "resume_project"}}},
          "then": {
            "properties": {
              "data": {
                "type": "object",
                "required": ["project_id"],
                "properties": {
                  "project_id": {
                    "$ref": "https://officeclaw.dev/schemas/identifiers.schema.json#/$defs/project_id"
                  },
                  "reason": {"type": "string", "minLength": 1},
                  "expected_project_status": {
                    "type": "string",
                    "enum": [
                      "created",
                      "planning",
                      "executing",
                      "blocked",
                      "completed",
                      "archived"
                    ]
                  }
                },
                "additionalProperties": true
              }
            }
          }
        },
        {
          "if": {"properties": {"name": {"const": "rerun_task"}}},
          "then": {
            "properties": {
              "data": {
                "type": "object",
                "required": ["source_task_id"],
                "properties": {
                  "source_task_id": {
                    "$ref": "https://officeclaw.dev/schemas/identifiers.schema.json#/$defs/task_id"
                  },
                  "mode": {"type": "string", "enum": ["clone_as_new"]},
                  "reason": {"type": "string", "minLength": 1},
                  "constraints_patch": {"type": "object"}
                },
                "additionalProperties": true
              }
            }
          }
        }
      ]
    },
    "ack_payload": {
      "type": "object",
      "required": ["in_reply_to", "status"],
      "additionalProperties": false,
      "properties": {
        "in_reply_to": {
          "$ref": "https://officeclaw.dev/schemas/identifiers.schema.json#/$defs/message_id"
        },
        "status": {"type": "string", "enum": ["ok"]}
      }
    },
    "error_payload": {
      "type": "object",
      "required": ["in_reply_to", "code", "message"],
      "additionalProperties": false,
      "properties": {
        "in_reply_to": {
          "$ref": "https://officeclaw.dev/schemas/identifiers.schema.json#/$defs/message_id"
        },
        "code": {"$ref": "#/$defs/error_code"},
        "message": {"type": "string", "minLength": 1}
      }
    }
  }
}
