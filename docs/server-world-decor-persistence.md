# Server-World Decor Persistence and Snapshot Hydration (`bd-iov`)

Last updated: 2026-02-14

## Scope

This pass validates and hardens decor unlock persistence/hydration behavior on top of anchor-aware placement work:

- decor unlock outcomes persist through command-journal restoration
- restored snapshots continue to hydrate `office_decor` rows
- decor anchor compatibility remains aligned with scene manifest anchor IDs

## Runtime Persistence Path

- Server command journal replay is exercised via world-server restoration tests.
- Decor unlock outcomes generated by command flow are expected to re-materialize after restart.
- Restored snapshots expose `office_decor[]` for client hydration.

## Repository Persistence Path

Repository layer decor APIs are validated for persistence reads:

- `repos.officeDecor.upsert(...)`
- `repos.officeDecor.listByProject(projectId)`

This confirms storage/retrieval of:

- `decor_id`
- `project_id`
- `anchor_id`
- `unlocked_by_project_id`
- `outcome`

## Validation Coverage

Updated tests:

- `apps/server-world/test/worldServer.test.mjs`
  - restoration bootstrap now validates decor unlock persistence across restart
  - verifies restored `office_decor` row shape and deterministic anchor/outcome values
- `packages/repository/test/repository.test.mjs`
  - validates office decor repository upsert/list hydration reads

Commands:

```bash
npm --prefix apps/server-world test
npm --prefix contracts run validate
npm --prefix packages/repository test
```
